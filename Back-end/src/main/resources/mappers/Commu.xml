<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 	
		 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.web.curation.dao.CommuDao">
	<!-- 관리자 편성표 추가-->
	<insert id="addCommu" parameterType="com.web.curation.dto.CommuDto">
		insert into Community(co_content, co_img, u_email)
		value(#{co_content}, #{co_img} ,#{u_email});
	</insert>
	
	<!-- 관리자 편성표 삭제 -->
	<delete id="deleteCommu" parameterType="int">
		delete from Community where co_idx = #{co_idx};
	</delete>
	
	<!-- 관리자 편성표 리스트 출력 -->
	<select id="getCommuList" resultType="com.web.curation.dto.CommuDto">
		select co_idx, co_content,u_email, co_date from Community ;
	</select>
	
	<!-- 게시글 디테일(게시글 + 댓글 리스트 +유저 이름) -->
	<select id="getCommuDetail" resultType="com.web.curation.dto.CommuReplyUser">
		select 	cc.co_idx , 
		cc.co_content ,
		cc.co_img ,
		cc.co_date ,
		uii.u_name as co_name, 
		cc.cr_idx ,
		cc.cr_content , 
		cc.cr_name as cr_name
		FROM 	(
					SELECT 	c.co_idx , 
							c.co_content ,
							c.co_img ,
							c.co_date ,
							c.u_email as co_email, 
							cr.cr_idx ,
							cr.cr_content , 
							ui.u_name as cr_name
					FROM 	CoReply cr 
					left outer join UserInfo ui 
									on cr.u_email = ui.u_email 
					left outer join Community c 
									on c.co_idx =cr.co_idx 
					where 	c.co_idx =#{co_idx} 
				) cc
		left outer join UserInfo uii
						on uii.u_email = cc.co_email ;
				
	</select>
	
	<!-- 댓글 추가-->
	<insert id="addCommuReply" parameterType="com.web.curation.dto.CoReplyDto">
		insert into CoReply (cr_content, u_email, co_idx)
		value	(#{cr_content}, #{u_email}, #{co_idx} );
	</insert>
	
	<!-- 댓글 삭제 -->
	<delete id="deleteCommuReply" parameterType="com.web.curation.dto.CoReplyDto">
		delete 	from CoReply 
		where 	1=1
		and 	co_idx = #{co_idx}
		and		cr_idx = #{cr_idx};
	</delete> 
	
 </mapper>
        